local SilentAim = {}
SilentAim.Enabled = false

local Services = loadstring(game:HttpGet(
    "https://raw.githubusercontent.com/AccountBurner/Utility/refs/heads/main/Services"
))()

local Players, Workspace = Services:Get("Players", "Workspace")
local Camera = Workspace.CurrentCamera

local _G = getrenv()._G
local globals = _G.globals
local exe_map = debug.getupvalues(_G.append_exe_set)[1]

local cli_state = globals.cli_state
local sol_teams = globals.sol_teams
local soldiers_spawned = globals.soldiers_spawned
local soldiers_alive = globals.soldiers_alive
local soldier_models = globals.soldier_models

local function getClosestEnemy()
    local closest, dist = nil, math.huge
    local myId = cli_state.fpv_sol_id
    local myTeam = sol_teams[myId]
    local camPos = Camera.CFrame.Position

    for id, spawned in pairs(soldiers_spawned) do
        if spawned
        and soldiers_alive[id]
        and id ~= myId
        and sol_teams[id] ~= myTeam then

            local model = soldier_models[id]
            if model and model.PrimaryPart then
                local part = model:FindFirstChild("Head") or model.PrimaryPart
                local d = (part.Position - camPos).Magnitude
                if d < dist then
                    dist = d
                    closest = part
                end
            end
        end
    end

    return closest
end

local old_spawn = exe_map[_G.exe_func_t.SPAWN_FPV_SOL_BULLET]

exe_map[_G.exe_func_t.SPAWN_FPV_SOL_BULLET] = function(id, type, pos, vel)
    if SilentAim.Enabled then
        local target = getClosestEnemy()
        if target then
            vel = (target.Position - pos).Unit * vel.Magnitude
        end
    end
    return old_spawn(id, type, pos, vel)
end

function SilentAim:Enable()
    self.Enabled = true
end

function SilentAim:Disable()
    self.Enabled = false
end

return SilentAim
